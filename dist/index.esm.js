import n,{createContext as t,useContext as o,useState as e,useEffect as r,useRef as i,Children as a,isValidElement as l,cloneElement as c}from"react";import{CmUtils as s,HtmlUtils as p,Hooks as u}from"@delpi/common";import{Ifz as d}from"react-if-vz";import{createPortal as f}from"react-dom";import m,{keyframes as h,css as w}from"styled-components";var v=function(){return v=Object.assign||function(n){for(var t,o=1,e=arguments.length;o<e;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},v.apply(this,arguments)};function y(n,t){var o={};for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&t.indexOf(e)<0&&(o[e]=n[e]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(e=Object.getOwnPropertySymbols(n);r<e.length;r++)t.indexOf(e[r])<0&&Object.prototype.propertyIsEnumerable.call(n,e[r])&&(o[e[r]]=n[e[r]])}return o}function g(n,t){return Object.defineProperty?Object.defineProperty(n,"raw",{value:t}):n.raw=t,n}"function"==typeof SuppressedError&&SuppressedError;var b,x,C,k,E,z,P,S,O,L,N,W,M,T,j,B,I,H=t({}),A=function(t){var o=t.shareContext,e=y(t,["shareContext"]);return o?n.createElement(H.Provider,{value:e},e.children):e.children},D=function(){return o(H)},R="#282727",X=-12,Y={fade:[h(b||(b=g(["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    opacity: 1;\n  }\n"],["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    opacity: 1;\n  }\n"]))),h(x||(x=g(["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(.25);\n  }\n"],["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(.25);\n  }\n"])))],zoom:[h(C||(C=g(["\n  from {\n    transform: scale(.25);\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(1);\n    opacity: 1;\n  }\n"],["\n  from {\n    transform: scale(.25);\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(1);\n    opacity: 1;\n  }\n"]))),h(k||(k=g(["\n  from {\n    transform: scale(1);\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(.25);\n    opacity: 1;\n  }\n"],["\n  from {\n    transform: scale(1);\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(.25);\n    opacity: 1;\n  }\n"])))]},F=m.div(E||(E=g(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"],["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"]))),q=m(F)(N||(N=g(["\n  position: absolute;\n  top: ","px;\n  left: ","px;\n  padding: 0.25rem 0.75rem;\n  border-radius: 8px;\n  background: ",";\n  color: ",";\n  font-size: 14px;\n  z-index: 1111;\n\n  visibility: ",";\n  animation: ","\n    "," ease-in;\n  transition: visibility "," ease-in;\n  z-index: 1111;\n\n  div.ldk-content {\n    position: relative;\n    max-width: ",";\n    word-break: break-all;\n    height: 100%;\n  }\n\n  div.ldk-icon {\n    position: absolute;\n    width: 0;\n    height: 0;\n    border: 5px solid transparent;\n    /* -webkit-transition: opacity 1s linear;\n      -moz-transition: opacity 1s linear;\n      -o-transition: opacity 1s linear;\n      transition: opacity 1s linear; */\n    ","\n    ","\n      ","\n  ","\n  ","\n  }\n"],["\n  position: absolute;\n  top: ","px;\n  left: ","px;\n  padding: 0.25rem 0.75rem;\n  border-radius: 8px;\n  background: ",";\n  color: ",";\n  font-size: 14px;\n  z-index: 1111;\n\n  visibility: ",";\n  animation: ","\n    "," ease-in;\n  transition: visibility "," ease-in;\n  z-index: 1111;\n\n  div.ldk-content {\n    position: relative;\n    max-width: ",";\n    word-break: break-all;\n    height: 100%;\n  }\n\n  div.ldk-icon {\n    position: absolute;\n    width: 0;\n    height: 0;\n    border: 5px solid transparent;\n    /* -webkit-transition: opacity 1s linear;\n      -moz-transition: opacity 1s linear;\n      -o-transition: opacity 1s linear;\n      transition: opacity 1s linear; */\n    ","\n    ","\n      ","\n  ","\n  ","\n  }\n"])),(function(n){return n.top}),(function(n){return n.left}),(function(n){return n.backgroundColor||R}),(function(n){return n.tooltipColor||"#ffffff"}),(function(n){return n.top?"visible":"hidden"}),(function(n){return n.top?Y[n.display][0]:Y[n.display][1]}),(function(n){return n.delayShow}),(function(n){return n.delayShow}),(function(n){return n.limitWidth?"200px":"none"}),(function(n){return n.pos&&w(z||(z=g(["\n      /* opacity: 1; */\n      border-",": 8px solid ",";\n  "],["\n      /* opacity: 1; */\n      border-",": 8px solid ",";\n  "])),n.pos,n.backgroundColor||R)}),(function(n){return"bottom"===n.pos&&w(P||(P=g(["\n        top: ","px;\n        left: ","px;\n      "],["\n        top: ","px;\n        left: ","px;\n      "])),X,n.arrowPos)}),(function(n){return"top"===n.pos&&w(S||(S=g(["\n        bottom: ","px;\n        left: ","px;\n      "],["\n        bottom: ","px;\n        left: ","px;\n      "])),X,n.arrowPos)}),(function(n){return"right"===n.pos&&w(O||(O=g(["\n        top: ","px;\n        left: ","px;\n      "],["\n        top: ","px;\n        left: ","px;\n      "])),n.arrowPos,X)}),(function(n){return"left"===n.pos&&w(L||(L=g(["\n        top: ","px;\n        right: ","px;\n      "],["\n        top: ","px;\n        right: ","px;\n      "])),n.arrowPos,X)}));m.div(I||(I=g(["\n  position: absolute;\n  width: 0;\n  height: 0;\n  border: 5px solid transparent;\n  /* -webkit-transition: opacity 1s linear;\n    -moz-transition: opacity 1s linear;\n    -o-transition: opacity 1s linear;\n    transition: opacity 1s linear; */\n  ","\n  ","\n    ","\n    ","\n    ","\n"],["\n  position: absolute;\n  width: 0;\n  height: 0;\n  border: 5px solid transparent;\n  /* -webkit-transition: opacity 1s linear;\n    -moz-transition: opacity 1s linear;\n    -o-transition: opacity 1s linear;\n    transition: opacity 1s linear; */\n  ","\n  ","\n    ","\n    ","\n    ","\n"])),(function(n){return n.pos&&w(W||(W=g(["\n      border-",": 8px solid ",";\n    "],["\n      border-",": 8px solid ",";\n    "])),n.pos,n.backgroundColor||R)}),(function(n){return"bottom"===n.pos&&w(M||(M=g(["\n      top: -12px;\n      left: ","px;\n    "],["\n      top: -12px;\n      left: ","px;\n    "])),n.arrowPos)}),(function(n){return"top"===n.pos&&w(T||(T=g(["\n      bottom: -12px;\n      left: ","px;\n    "],["\n      bottom: -12px;\n      left: ","px;\n    "])),n.arrowPos)}),(function(n){return"right"===n.pos&&w(j||(j=g(["\n      top: ","px;\n      left: -10px;\n    "],["\n      top: ","px;\n      left: -10px;\n    "])),n.arrowPos)}),(function(n){return"left"===n.pos&&w(B||(B=g(["\n      top: ","px;\n      right: -10px;\n    "],["\n      top: ","px;\n      right: -10px;\n    "])),n.arrowPos)}));var $=function(t){var o=t.children;return"function"==typeof o?n.createElement(n.Fragment,null,o()):o},G=function(){var n=e(),t=n[0],o=n[1];return r((function(){var n=window.document.body.querySelector("#portal-tooltip");n||((n=window.document.createElement("div")).setAttribute("id","portal-tooltip"),window.document.body.append(n)),o(n)}),[]),t},J=function(){return window.innerWidth+window.pageXOffset},K=function(){return window.innerHeight+window.pageYOffset},Q=function(n){void 0===n&&(n=window.event);var t=!1;return"which"in n?t=3===n.which:"button"in n&&(t=2===n.button),t},U=function(n){return/^\d+$/.test("".concat(n||250))?"".concat(n,"ms"):n},V=function(n,t,o,e,r,i,a,l){void 0===l&&(l=30);var c="horizontal"===a?J():K(),s="horizontal"===a?5:4,p="horizontal"===a?o.clientWidth:o.clientHeight;if(n){l="horizontal"===a?50:47;var u=p/2,d=r+e/2,f=0;return d+u>c?(t=c-p,f=p-(c-i+e/2)-s):d-u<0?(t=0,f=Math.floor(e*l/100)-s):(t=d-u,f=Math.floor(p*l/100)-s),[t,f]}t+p>c?(t=c-p,l=50):p<e&&(e=p);var m=Math.floor(e*l/100)+r-t;return m>=6&&(m-=1),[t,m]},Z=function(t){var o=t.tooltipId,e=t.isShow,a=t.tooltipContent,l=t.tooltipClassName,c=t.placement,u=t.target,d=t.limitWidth,m=t.resizeSize,h=t.delayShow,w=t.display,v=t.top,y=t.bottom,g=t.right,b=t.left,x=t.backgroundColor,C=t.tooltipColor,k=t.centerArrow,E=t.setTargetTooltip,z=void 0===E?function(){}:E,P=i({clientTop:0,clientLeft:0,posPlacement:null,arrowPos:null}),S=i(null),O=G();return r((function(){var n,t,o,r,i,l,p=(S||{}).current;if(z(p),e||(P.current.clientTop=null,P.current.clientLeft=0),s.isNil(a))return P.current.clientTop=null,void(P.current.clientLeft=0);if(p&&u){var d=v?"top":g?"right":y?"bottom":b?"left":c||"top",f=u.getBoundingClientRect(),m=f.top,h=f.left,w=f.bottom,x=f.right,C=f.width,E=f.height;m+=window.pageYOffset,w+=window.pageYOffset,h+=window.pageXOffset,x+=window.pageXOffset;var O=function(){return m-p.clientHeight-8},L=function(){return x+10},N=function(){return w+8},W=function(){return h-p.clientWidth-10},M=0,T=h,j=O();switch(d){case"top":j<0&&(d="bottom",j=N()),T=(n=V(Boolean(k),T,p,C,h,x,"horizontal"))[0],M=n[1];break;case"bottom":(j=N())>K()&&(d="top",j=O()),T=(t=V(Boolean(k),T,p,C,h,x,"horizontal"))[0],M=t[1];break;case"left":j=m,(T=W())<0&&(d="right",T=L()),T+p.clientWidth>J()?(d="top",T=h,j=O(),T=(o=V(Boolean(k),T,p,C,h,x,"horizontal"))[0],M=o[1]):(j=(r=V(Boolean(k),j,p,E,m,w,"vertical"))[0],M=r[1]),j<0&&(d="bottom",j=N());break;case"right":j=m,(T=L())+p.clientWidth>J()&&(d="left",T=W()),T<0?(d="top",T=h,j=O(),T=(i=V(Boolean(k),T,p,C,h,x,"horizontal"))[0],M=i[1]):(j=(l=V(Boolean(k),j,p,E,m,w,"vertical"))[0],M=l[1]),j<0&&(d="bottom",j=N())}P.current.arrowPos=M,P.current.clientTop=j,P.current.clientLeft=T,P.current.posPlacement=d}}),[e,u,m,a,l,c,v,g,y,b]),O&&e?f(n.createElement(q,{id:o,ref:S,className:p.joinClass([l,"ldk-placement-".concat(P.current.posPlacement)]),top:P.current.clientTop,left:P.current.clientLeft,pos:P.current.posPlacement,arrowPos:P.current.arrowPos,limitWidth:d,delayShow:U(h),display:w,backgroundColor:x,tooltipColor:C},n.createElement("div",{className:"ldk-icon"}),n.createElement(F,{className:"ldk-content"},n.createElement($,null,a))),O):n.createElement(n.Fragment,null)},_=function(t){var o=t.children,f=t.tagName,m=t.className,h=t.style,w=t.tooltipClassName,g=t.tooltipContent,b=t.placement,x=void 0===b?"top":b,C=t.trigger,k=void 0===C?"hover":C,E=t.delayShow,z=void 0===E?250:E,P=t.display,S=void 0===P?"fade":P,O=t.backgroundColor,L=t.tooltipColor,N=t.limitWidth,W=void 0===N||N,M=t.handleClick,T=void 0===M?function(){}:M,j=t.handleMouseEnter,B=void 0===j?function(){}:j,I=t.handleMouseLeave,H=void 0===I?function(){}:I,D=t.onClick,R=void 0===D?function(){}:D,X=t.onMouseEnter,Y=void 0===X?function(){}:X,F=t.onMouseLeave,q=void 0===F?function(){}:F,$=t.onShown,G=void 0===$?function(){}:$,J=t.onHidden,K=void 0===J?function(){}:J,U=t.mouseWheel,V=void 0===U||U,_=t.shareContext,nn=void 0===_||_,tn=t.open,on=t.showSync,en=t.hideIfResize,rn=void 0===en||en,an=t.hideIfScroll,ln=t.top,cn=t.bottom,sn=t.right,pn=t.left,un=t.centerArrow,dn=t.forceHide,fn=y(t,["children","tagName","className","style","tooltipClassName","tooltipContent","placement","trigger","delayShow","display","backgroundColor","tooltipColor","limitWidth","handleClick","handleMouseEnter","handleMouseLeave","onClick","onMouseEnter","onMouseLeave","onShown","onHidden","mouseWheel","shareContext","open","showSync","hideIfResize","hideIfScroll","top","bottom","right","left","centerArrow","forceHide"]),mn=e(f)[0],hn=e(s.idv4Time("dk-ttip"))[0],wn=e({}),vn=wn[0],yn=wn[1],gn=e(null),bn=gn[0],xn=gn[1],Cn=e(null),kn=Cn[0],En=Cn[1],zn=i([]),Pn=u.useWindowSize(),Sn="manual"===k,On=["hover","focus"].includes(k);r((function(){var n=vn.target||zn.current[0];tn&&n&&(yn({target:n,show:!1}),setTimeout((function(){return yn((function(n){return v(v({},n),{show:!0})}))})))}),[tn]),r((function(){Sn&&yn({target:zn.current[0],show:on})}),[on]),r((function(){rn&&Ln()}),[rn,Pn]),r((function(){!s.isNil(dn)&&Ln()}),[dn]),r((function(){return vn.show?(document.addEventListener("mousedown",Mn),document.addEventListener("touchstart",Mn),document.addEventListener("scroll",Nn),V&&document.addEventListener("wheel",Nn)):(Wn(),xn(null)),function(){Wn()}}),[vn.show]);var Ln=function(){vn.show&&(xn(null),Wn(),yn((function(n){return v(v({},n),{show:!1})})),K(!1))},Nn=function(){an&&Ln()},Wn=function(){document.removeEventListener("mousedown",Mn),document.removeEventListener("touchstart",Mn),document.removeEventListener("scroll",Nn),V&&document.removeEventListener("wheel",Nn)},Mn=function(n){void 0===n&&(n=window.event);try{if(Sn||n.target.closest("#".concat(hn)))return}catch(n){}Q(n)||!vn.target||p.elContains(vn.target,n.target)||Ln()},Tn=function(n,t){var e=n.target,r=function(){yn({show:!0,target:zn.current[t]}),G(),n.preventDefault(),n.stopPropagation()};return a.count(o)>1?vn.target===zn.current[t]&&vn.show?(n.preventDefault(),n.stopPropagation(),Ln(),void yn({show:!1,target:zn.current[t]})):void(-1!==t&&r()):p.elContains(vn.target,e)&&vn.show?(n.preventDefault(),void n.stopPropagation()):void(-1!==t&&r())},jn=function(n){H(n),q(n),On&&Ln()},Bn=function(n){return v({onMouseEnter:function(t){return function(n,t){B(n),Y(n),On&&Tn(n,t)}(t,n)},onMouseLeave:jn,onClick:function(t){return function(n,t){T(n),R(n),"click"===k&&Tn(n,t)}(t,n)},ref:function(t){return zn.current[n]=t},className:m,style:h},fn)};return n.createElement(A,{shareContext:nn,showTooltip:function(n){xn(n),yn((function(n){return v(v({},n),{show:!0})})),G()},hideTooltip:Ln,isShow:Boolean(vn.show),tooltipId:hn,tooltipElement:kn},n.createElement(d,null,n.createElement(d.If,{condition:!mn},a.map(o,(function(n,t){return l(n)?c(n,v({},Bn(t))):n}))),n.createElement(d.Else,null,n.createElement(mn,v({},Bn(0)),o))),n.createElement(Z,{tooltipId:hn,isShow:Boolean(vn.show),tooltipClassName:w,tooltipContent:bn||g,placement:x,target:vn.target,limitWidth:W,resizeSize:Pn,delayShow:z,display:S,top:ln,bottom:cn,right:sn,left:pn,backgroundColor:O,tooltipColor:L,centerArrow:un,setTargetTooltip:En}))};export{_ as Tooltip,$ as TooltipContent,A as TooltipContext,Z as TooltipPortal,_ as default,U as delayTime,Q as isMouseRightClick,K as overHeight,J as overWidth,G as usePortalTooltip,D as useTooltipContext};
