import n,{createContext as t,useContext as o,useState as e,useEffect as r,useRef as i,Children as a,isValidElement as l,cloneElement as c}from"react";import{CmUtils as s,HtmlUtils as p,Hooks as u}from"@delpi/common";import{If as d,Then as f,Else as h}from"react-ifz";import{createPortal as m}from"react-dom";import w,{keyframes as v,css as g}from"styled-components";var y=function(){return y=Object.assign||function(n){for(var t,o=1,e=arguments.length;o<e;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},y.apply(this,arguments)};function b(n,t){var o={};for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&t.indexOf(e)<0&&(o[e]=n[e]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(e=Object.getOwnPropertySymbols(n);r<e.length;r++)t.indexOf(e[r])<0&&Object.prototype.propertyIsEnumerable.call(n,e[r])&&(o[e[r]]=n[e[r]])}return o}function x(n,t){return Object.defineProperty?Object.defineProperty(n,"raw",{value:t}):n.raw=t,n}"function"==typeof SuppressedError&&SuppressedError;var C,k,E,P,S,W,O,L,M,z,H,N,T,j,I,A,B,D=t({}),R=function(t){var o=t.shareContext,e=b(t,["shareContext"]);return n.createElement(d,{condition:!o},n.createElement(f,null,e.children),n.createElement(h,null,n.createElement(D.Provider,{value:e},e.children)))},X=function(){return o(D)},Y="#282727",F=-12,q={fade:[v(C||(C=x(["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    opacity: 1;\n  }\n"],["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    opacity: 1;\n  }\n"]))),v(k||(k=x(["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(.25);\n  }\n"],["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(.25);\n  }\n"])))],zoom:[v(E||(E=x(["\n  from {\n    transform: scale(.25);\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(1);\n    opacity: 1;\n  }\n"],["\n  from {\n    transform: scale(.25);\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(1);\n    opacity: 1;\n  }\n"]))),v(P||(P=x(["\n  from {\n    transform: scale(1);\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(.25);\n    opacity: 1;\n  }\n"],["\n  from {\n    transform: scale(1);\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(.25);\n    opacity: 1;\n  }\n"])))]},$=w.div(S||(S=x(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"],["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"]))),G=w($)(H||(H=x(["\n  position: absolute;\n  top: ","px;\n  left: ","px;\n  padding: 0.25rem 0.75rem;\n  border-radius: 8px;\n  background: ",";\n  color: ",";\n  font-size: 14px;\n\n  visibility: ",";\n  animation: ","\n    "," ease-in;\n  transition: visibility "," ease-in;\n\n  div.ldk-content {\n    position: relative;\n    max-width: ",";\n    word-break: break-all;\n    height: 100%;\n  }\n\n  div.ldk-icon {\n    position: absolute;\n    width: 0;\n    height: 0;\n    border: 5px solid transparent;\n    /* -webkit-transition: opacity 1s linear;\n      -moz-transition: opacity 1s linear;\n      -o-transition: opacity 1s linear;\n      transition: opacity 1s linear; */\n    ","\n    ","\n      ","\n  ","\n  ","\n  }\n"],["\n  position: absolute;\n  top: ","px;\n  left: ","px;\n  padding: 0.25rem 0.75rem;\n  border-radius: 8px;\n  background: ",";\n  color: ",";\n  font-size: 14px;\n\n  visibility: ",";\n  animation: ","\n    "," ease-in;\n  transition: visibility "," ease-in;\n\n  div.ldk-content {\n    position: relative;\n    max-width: ",";\n    word-break: break-all;\n    height: 100%;\n  }\n\n  div.ldk-icon {\n    position: absolute;\n    width: 0;\n    height: 0;\n    border: 5px solid transparent;\n    /* -webkit-transition: opacity 1s linear;\n      -moz-transition: opacity 1s linear;\n      -o-transition: opacity 1s linear;\n      transition: opacity 1s linear; */\n    ","\n    ","\n      ","\n  ","\n  ","\n  }\n"])),(function(n){return n.top}),(function(n){return n.left}),(function(n){return n.backgroundColor||Y}),(function(n){return n.tooltipColor||"#ffffff"}),(function(n){return n.top?"visible":"hidden"}),(function(n){return n.top?q[n.display][0]:q[n.display][1]}),(function(n){return n.delayShow}),(function(n){return n.delayShow}),(function(n){return n.limitWidth?"200px":"none"}),(function(n){return n.pos&&g(W||(W=x(["\n      /* opacity: 1; */\n      border-",": 8px solid ",";\n  "],["\n      /* opacity: 1; */\n      border-",": 8px solid ",";\n  "])),n.pos,n.backgroundColor||Y)}),(function(n){return"bottom"===n.pos&&g(O||(O=x(["\n        top: ","px;\n        left: ","px;\n      "],["\n        top: ","px;\n        left: ","px;\n      "])),F,n.arrowPos)}),(function(n){return"top"===n.pos&&g(L||(L=x(["\n        bottom: ","px;\n        left: ","px;\n      "],["\n        bottom: ","px;\n        left: ","px;\n      "])),F,n.arrowPos)}),(function(n){return"right"===n.pos&&g(M||(M=x(["\n        top: ","px;\n        left: ","px;\n      "],["\n        top: ","px;\n        left: ","px;\n      "])),n.arrowPos,F)}),(function(n){return"left"===n.pos&&g(z||(z=x(["\n        top: ","px;\n        right: ","px;\n      "],["\n        top: ","px;\n        right: ","px;\n      "])),n.arrowPos,F)}));w.div(B||(B=x(["\n  position: absolute;\n  width: 0;\n  height: 0;\n  border: 5px solid transparent;\n  /* -webkit-transition: opacity 1s linear;\n    -moz-transition: opacity 1s linear;\n    -o-transition: opacity 1s linear;\n    transition: opacity 1s linear; */\n  ","\n  ","\n    ","\n    ","\n    ","\n"],["\n  position: absolute;\n  width: 0;\n  height: 0;\n  border: 5px solid transparent;\n  /* -webkit-transition: opacity 1s linear;\n    -moz-transition: opacity 1s linear;\n    -o-transition: opacity 1s linear;\n    transition: opacity 1s linear; */\n  ","\n  ","\n    ","\n    ","\n    ","\n"])),(function(n){return n.pos&&g(N||(N=x(["\n      border-",": 8px solid ",";\n    "],["\n      border-",": 8px solid ",";\n    "])),n.pos,n.backgroundColor||Y)}),(function(n){return"bottom"===n.pos&&g(T||(T=x(["\n      top: -12px;\n      left: ","px;\n    "],["\n      top: -12px;\n      left: ","px;\n    "])),n.arrowPos)}),(function(n){return"top"===n.pos&&g(j||(j=x(["\n      bottom: -12px;\n      left: ","px;\n    "],["\n      bottom: -12px;\n      left: ","px;\n    "])),n.arrowPos)}),(function(n){return"right"===n.pos&&g(I||(I=x(["\n      top: ","px;\n      left: -10px;\n    "],["\n      top: ","px;\n      left: -10px;\n    "])),n.arrowPos)}),(function(n){return"left"===n.pos&&g(A||(A=x(["\n      top: ","px;\n      right: -10px;\n    "],["\n      top: ","px;\n      right: -10px;\n    "])),n.arrowPos)}));var J=function(t){var o=t.children;return"function"==typeof o?n.createElement(n.Fragment,null,o()):o},K=function(){var n=e(),t=n[0],o=n[1];return r((function(){var n=window.document.body.querySelector("#portal-tooltip");n||((n=window.document.createElement("div")).setAttribute("id","portal-tooltip"),window.document.body.append(n)),o(n)}),[]),t},Q=function(){return window.innerWidth+window.pageXOffset},U=function(){return window.innerHeight+window.pageYOffset},V=function(n){void 0===n&&(n=window.event);var t=!1;return"which"in n?t=3===n.which:"button"in n&&(t=2===n.button),t},Z=function(n){return/^\d+$/.test("".concat(n||250))?"".concat(n,"ms"):n},_=function(t){var o=t.tooltipId,e=t.isShow,a=t.tooltipContent,l=t.tooltipClassName,c=t.placement,u=t.target,d=t.limitWidth,f=t.resizeSize,h=t.delayShow,w=t.display,v=t.top,g=t.bottom,y=t.right,b=t.left,x=t.backgroundColor,C=t.tooltipColor,k=t.centerArrow,E=t.setTargetTooltip,P=void 0===E?function(){}:E,S=i({clientTop:0,clientLeft:0,posPlacement:null,arrowPos:null}),W=i(null),O=K(),L=function(n,t,o,e,r,i){void 0===i&&(i=30);var a=Q();if(k){i=50;var l=t.clientWidth/2,c=e+o/2,s=0;return c+l>a?(e=a-t.clientWidth,s=t.clientWidth-(a-r+o/2)-5):c-l<0?(e=0,s=Math.floor(o*i/100)-5):(e=c-l,s=Math.floor(t.clientWidth*i/100)-5),[e,s]}n+t.clientWidth>a?(n=a-t.clientWidth,i=50):t.clientWidth<o&&(o=t.clientWidth);var p=Math.floor(o*i/100)+e-n;return p>=6&&(p-=1),[n,p]},M=function(n,t,o,e,r,i){void 0===i&&(i=30);var a=U();if(k){i=47;var l=t.clientHeight/2,c=e+o/2,s=0;return c+l>a?(e=a-t.clientHeight,s=t.clientHeight-(a-r+o/2)-4):c-l<0?(e=0,s=Math.floor(o*i/100)-4):(e=c-l,s=Math.floor(t.clientHeight*i/100)-4),[e,s]}n+t.clientHeight>a?(n=a-t.clientHeight,i=50):t.clientHeight<o&&(o=t.clientHeight);var p=Math.floor(o*i/100)+e-n;return p>=6&&(p-=1),[n,p]};return r((function(){var n,t,o,r,i,l,p=(W||{}).current;if(P(p),e||(S.current.clientTop=null,S.current.clientLeft=0),s.isNil(a))return S.current.clientTop=null,void(S.current.clientLeft=0);if(p&&u){var d=v?"top":y?"right":g?"bottom":b?"left":c||"top",f=u.getBoundingClientRect(),h=f.top,m=f.left,w=f.bottom,x=f.right,C=f.width,k=f.height;h+=window.pageYOffset,w+=window.pageYOffset,m+=window.pageXOffset,x+=window.pageXOffset;var E=function(){return h-p.clientHeight-8},O=function(){return x+10},z=function(){return w+8},H=function(){return m-p.clientWidth-10},N=0,T=m,j=E();switch(d){case"top":j<0&&(d="bottom",j=z()),T=(n=L(T,p,C,m,x))[0],N=n[1];break;case"bottom":(j=z())>U()&&(d="top",j=E()),T=(t=L(T,p,C,m,x))[0],N=t[1];break;case"left":j=h,(T=H())<0&&(d="right",T=O()),T+p.clientWidth>Q()?(d="top",T=m,j=E(),T=(o=L(T,p,C,m,x))[0],N=o[1]):(j=(r=M(j,p,k,h,w))[0],N=r[1]),j<0&&(d="bottom",j=z());break;case"right":j=h,(T=O())+p.clientWidth>Q()&&(d="left",T=H()),T<0?(d="top",T=m,j=E(),T=(i=L(T,p,C,m,x))[0],N=i[1]):(j=(l=M(j,p,k,h,w))[0],N=l[1]),j<0&&(d="bottom",j=z())}S.current.arrowPos=N,S.current.clientTop=j,S.current.clientLeft=T,S.current.posPlacement=d}}),[e,u,f,a,l,c,v,y,g,b]),O&&e?m(n.createElement(G,{id:o,ref:W,className:p.joinClass([l,"ldk-placement-".concat(S.current.posPlacement)]),top:S.current.clientTop,left:S.current.clientLeft,pos:S.current.posPlacement,arrowPos:S.current.arrowPos,limitWidth:d,delayShow:Z(h),display:w,backgroundColor:x,tooltipColor:C},n.createElement("div",{className:"ldk-icon"}),n.createElement($,{className:"ldk-content"},n.createElement(J,null,a))),O):n.createElement(n.Fragment,null)},nn=function(t){var o=t.children,m=t.tagName,w=t.className,v=t.style,g=t.tooltipClassName,x=t.tooltipContent,C=t.placement,k=void 0===C?"top":C,E=t.trigger,P=void 0===E?"hover":E,S=t.delayShow,W=void 0===S?250:S,O=t.display,L=void 0===O?"fade":O,M=t.backgroundColor,z=t.tooltipColor,H=t.limitWidth,N=void 0===H||H,T=t.handleClick,j=void 0===T?function(){}:T,I=t.handleMouseEnter,A=void 0===I?function(){}:I,B=t.handleMouseLeave,D=void 0===B?function(){}:B,X=t.onClick,Y=void 0===X?function(){}:X,F=t.onMouseEnter,q=void 0===F?function(){}:F,$=t.onMouseLeave,G=void 0===$?function(){}:$,J=t.onShown,K=void 0===J?function(){}:J,Q=t.onHidden,U=void 0===Q?function(){}:Q,Z=t.mouseWheel,nn=void 0===Z||Z,tn=t.shareContext,on=void 0===tn||tn,en=t.open,rn=t.showSync,an=t.hideIfResize,ln=void 0===an||an,cn=t.hideIfScroll,sn=t.top,pn=t.bottom,un=t.right,dn=t.left,fn=t.centerArrow,hn=t.forceHide,mn=b(t,["children","tagName","className","style","tooltipClassName","tooltipContent","placement","trigger","delayShow","display","backgroundColor","tooltipColor","limitWidth","handleClick","handleMouseEnter","handleMouseLeave","onClick","onMouseEnter","onMouseLeave","onShown","onHidden","mouseWheel","shareContext","open","showSync","hideIfResize","hideIfScroll","top","bottom","right","left","centerArrow","forceHide"]),wn=e(m)[0],vn=e(s.idv4Time("dk-ttip"))[0],gn=e({}),yn=gn[0],bn=gn[1],xn=e(null),Cn=xn[0],kn=xn[1],En=e(null),Pn=En[0],Sn=En[1],Wn=i([]),On=u.useWindowSize(),Ln="manual"===P,Mn=["hover","focus"].includes(P);r((function(){var n=yn.target||Wn.current[0];en&&n&&(bn({target:n,show:!1}),setTimeout((function(){return bn((function(n){return y(y({},n),{show:!0})}))})))}),[en]),r((function(){Ln&&bn({target:Wn.current[0],show:rn})}),[rn]),r((function(){ln&&zn()}),[ln,On]),r((function(){!s.isNil(hn)&&zn()}),[hn]),r((function(){return yn.show?(document.addEventListener("mousedown",Tn),document.addEventListener("touchstart",Tn),document.addEventListener("scroll",Hn),nn&&document.addEventListener("wheel",Hn)):(Nn(),kn(null)),function(){Nn()}}),[yn.show]);var zn=function(){yn.show&&(kn(null),Nn(),bn((function(n){return y(y({},n),{show:!1})})),U(!1))},Hn=function(){cn&&zn()},Nn=function(){document.removeEventListener("mousedown",Tn),document.removeEventListener("touchstart",Tn),document.removeEventListener("scroll",Hn),nn&&document.removeEventListener("wheel",Hn)},Tn=function(n){void 0===n&&(n=window.event);try{if(Ln||n.target.closest("#".concat(vn)))return}catch(n){}V(n)||!yn.target||p.elContains(yn.target,n.target)||zn()},jn=function(n,t){var e=n.target,r=function(){bn({show:!0,target:Wn.current[t]}),K(),n.preventDefault(),n.stopPropagation()};return a.count(o)>1?yn.target===Wn.current[t]&&yn.show?(n.preventDefault(),n.stopPropagation(),zn(),void bn({show:!1,target:Wn.current[t]})):void(-1!==t&&r()):p.elContains(yn.target,e)&&yn.show?(n.preventDefault(),void n.stopPropagation()):void(-1!==t&&r())},In=function(n){D(n),G(n),Mn&&zn()},An=function(n){return y({onMouseEnter:function(t){return function(n,t){A(n),q(n),Mn&&jn(n,t)}(t,n)},onMouseLeave:In,onClick:function(t){return function(n,t){j(n),Y(n),"click"===P&&jn(n,t)}(t,n)},ref:function(t){return Wn.current[n]=t},className:w,style:v},mn)};return n.createElement(R,{shareContext:on,showTooltip:function(n){kn(n),bn((function(n){return y(y({},n),{show:!0})})),K()},hideTooltip:zn,isShow:Boolean(yn.show),tooltipId:vn,tooltipElement:Pn},n.createElement(d,{condition:Boolean(wn)},n.createElement(f,null,n.createElement(wn,y({},An(0)),o)),n.createElement(h,null,a.map(o,(function(n,t){return l(n)?c(n,y({},An(t))):n})))),n.createElement(_,{tooltipId:vn,isShow:Boolean(yn.show),tooltipClassName:g,tooltipContent:Cn||x,placement:k,target:yn.target,limitWidth:N,resizeSize:On,delayShow:W,display:L,top:sn,bottom:pn,right:un,left:dn,backgroundColor:M,tooltipColor:z,centerArrow:fn,setTargetTooltip:Sn}))};export{nn as Tooltip,J as TooltipContent,R as TooltipContext,_ as TooltipPortal,nn as default,Z as getLazyTime,V as isMouseRightClick,U as overHeight,Q as overWidth,K as usePortalTooltip,X as useTooltipContext};
