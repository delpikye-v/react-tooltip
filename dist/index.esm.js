import n,{createContext as t,useContext as o,useState as e,useEffect as r,useRef as i,Children as a,isValidElement as l,cloneElement as c}from"react";import{CmUtils as s,HtmlUtils as u,Hooks as p}from"@delpi/common";import{Ifz as f,If as d,Else as m}from"react-if-vz";import{createPortal as h}from"react-dom";import v,{keyframes as w,css as g}from"styled-components";var b=function(){return b=Object.assign||function(n){for(var t,o=1,e=arguments.length;o<e;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},b.apply(this,arguments)};function y(n,t){var o={};for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&t.indexOf(e)<0&&(o[e]=n[e]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(e=Object.getOwnPropertySymbols(n);r<e.length;r++)t.indexOf(e[r])<0&&Object.prototype.propertyIsEnumerable.call(n,e[r])&&(o[e[r]]=n[e[r]])}return o}function x(n,t){return Object.defineProperty?Object.defineProperty(n,"raw",{value:t}):n.raw=t,n}"function"==typeof SuppressedError&&SuppressedError;var C,E,k,P,S,z,O,L,N,W,M,T,j,I,B,H,A,D=t({}),R=function(t){var o=t.shareContext,e=y(t,["shareContext"]);return n.createElement(f,null,n.createElement(d,{condition:!o},e.children),n.createElement(m,null,n.createElement(D.Provider,{value:e},e.children)))},X=function(){return o(D)},Y="#282727",F=-12,$={fade:[w(C||(C=x(["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    opacity: 1;\n  }\n"],["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    opacity: 1;\n  }\n"]))),w(E||(E=x(["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(.25);\n  }\n"],["\n  from {\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(.25);\n  }\n"])))],zoom:[w(k||(k=x(["\n  from {\n    transform: scale(.25);\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(1);\n    opacity: 1;\n  }\n"],["\n  from {\n    transform: scale(.25);\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(1);\n    opacity: 1;\n  }\n"]))),w(P||(P=x(["\n  from {\n    transform: scale(1);\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(.25);\n    opacity: 1;\n  }\n"],["\n  from {\n    transform: scale(1);\n    opacity: 0;\n  }\n\n  to {\n    transform: scale(.25);\n    opacity: 1;\n  }\n"])))]},q=v.div(S||(S=x(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"],["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"]))),G=v(q)(M||(M=x(["\n  position: absolute;\n  top: ","px;\n  left: ","px;\n  padding: 0.25rem 0.75rem;\n  border-radius: 8px;\n  background: ",";\n  color: ",";\n  font-size: 14px;\n  z-index: 1111;\n\n  visibility: ",";\n  animation: ","\n    "," ease-in;\n  transition: visibility "," ease-in;\n\n  div.ldk-content {\n    position: relative;\n    max-width: ",";\n    word-break: break-all;\n    height: 100%;\n  }\n\n  div.ldk-icon {\n    position: absolute;\n    width: 0;\n    height: 0;\n    border: 5px solid transparent;\n    /* -webkit-transition: opacity 1s linear;\n      -moz-transition: opacity 1s linear;\n      -o-transition: opacity 1s linear;\n      transition: opacity 1s linear; */\n    ","\n    ","\n      ","\n  ","\n  ","\n  }\n"],["\n  position: absolute;\n  top: ","px;\n  left: ","px;\n  padding: 0.25rem 0.75rem;\n  border-radius: 8px;\n  background: ",";\n  color: ",";\n  font-size: 14px;\n  z-index: 1111;\n\n  visibility: ",";\n  animation: ","\n    "," ease-in;\n  transition: visibility "," ease-in;\n\n  div.ldk-content {\n    position: relative;\n    max-width: ",";\n    word-break: break-all;\n    height: 100%;\n  }\n\n  div.ldk-icon {\n    position: absolute;\n    width: 0;\n    height: 0;\n    border: 5px solid transparent;\n    /* -webkit-transition: opacity 1s linear;\n      -moz-transition: opacity 1s linear;\n      -o-transition: opacity 1s linear;\n      transition: opacity 1s linear; */\n    ","\n    ","\n      ","\n  ","\n  ","\n  }\n"])),(function(n){return n.top}),(function(n){return n.left}),(function(n){return n.backgroundColor||Y}),(function(n){return n.tooltipColor||"#ffffff"}),(function(n){return n.top?"visible":"hidden"}),(function(n){return n.top?$[n.display][0]:$[n.display][1]}),(function(n){return n.delayShow}),(function(n){return n.delayShow}),(function(n){return n.limitWidth?"200px":"none"}),(function(n){return n.pos&&g(z||(z=x(["\n      /* opacity: 1; */\n      border-",": 8px solid ",";\n  "],["\n      /* opacity: 1; */\n      border-",": 8px solid ",";\n  "])),n.pos,n.backgroundColor||Y)}),(function(n){return"bottom"===n.pos&&g(O||(O=x(["\n        top: ","px;\n        left: ","px;\n      "],["\n        top: ","px;\n        left: ","px;\n      "])),F,n.arrowPos)}),(function(n){return"top"===n.pos&&g(L||(L=x(["\n        bottom: ","px;\n        left: ","px;\n      "],["\n        bottom: ","px;\n        left: ","px;\n      "])),F,n.arrowPos)}),(function(n){return"right"===n.pos&&g(N||(N=x(["\n        top: ","px;\n        left: ","px;\n      "],["\n        top: ","px;\n        left: ","px;\n      "])),n.arrowPos,F)}),(function(n){return"left"===n.pos&&g(W||(W=x(["\n        top: ","px;\n        right: ","px;\n      "],["\n        top: ","px;\n        right: ","px;\n      "])),n.arrowPos,F)}));v.div(A||(A=x(["\n  position: absolute;\n  width: 0;\n  height: 0;\n  border: 5px solid transparent;\n\n  ","\n  ","\n    ","\n    ","\n    ","\n"],["\n  position: absolute;\n  width: 0;\n  height: 0;\n  border: 5px solid transparent;\n\n  ","\n  ","\n    ","\n    ","\n    ","\n"])),(function(n){return n.pos&&g(T||(T=x(["\n      border-",": 8px solid ",";\n    "],["\n      border-",": 8px solid ",";\n    "])),n.pos,n.backgroundColor||Y)}),(function(n){return"bottom"===n.pos&&g(j||(j=x(["\n      top: -12px;\n      left: ","px;\n    "],["\n      top: -12px;\n      left: ","px;\n    "])),n.arrowPos)}),(function(n){return"top"===n.pos&&g(I||(I=x(["\n      bottom: -12px;\n      left: ","px;\n    "],["\n      bottom: -12px;\n      left: ","px;\n    "])),n.arrowPos)}),(function(n){return"right"===n.pos&&g(B||(B=x(["\n      top: ","px;\n      left: -10px;\n    "],["\n      top: ","px;\n      left: -10px;\n    "])),n.arrowPos)}),(function(n){return"left"===n.pos&&g(H||(H=x(["\n      top: ","px;\n      right: -10px;\n    "],["\n      top: ","px;\n      right: -10px;\n    "])),n.arrowPos)}));var J=function(t){var o=t.children;return"function"==typeof o?n.createElement(n.Fragment,null,o()):o},K=function(){var n=e(null),t=n[0],o=n[1];return r((function(){var n=document.getElementById("portal-tooltip");if(n)o(n);else{var t=document.createElement("div");t.id="portal-tooltip",document.body.appendChild(t),o(t)}}),[]),t},Q=function(){return window.innerWidth+window.pageXOffset},U=function(){return window.innerHeight+window.pageYOffset},V=function(n){return"which"in n?3===n.which:"button"in n&&2===n.button},Z=function(n){return/^\d+$/.test("".concat(n||250))?"".concat(n,"ms"):n},_=function(n,t,o,e,r,i,a,l){void 0===l&&(l=30);var c="horizontal"===a?Q():U(),s="horizontal"===a?5:4,u="horizontal"===a?o.clientWidth:o.clientHeight;if(n){l="horizontal"===a?50:47;var p=u/2,f=r+e/2,d=0;return f+p>c?(t=c-u,d=u-(c-i+e/2)-s):f-p<0?(t=0,d=Math.floor(e*l/100)-s):(t=f-p,d=Math.floor(u*l/100)-s),[t,d]}t+u>c?(t=c-u,l=50):u<e&&(e=u);var m=Math.floor(e*l/100)+r-t;return m>=6&&(m-=1),[t,m]},nn=function(t){var o=t.tooltipId,e=t.isShow,a=t.tooltipContent,l=t.tooltipClassName,c=t.placement,p=t.target,f=t.limitWidth,d=t.resizeSize,m=t.delayShow,v=t.display,w=t.top,g=t.bottom,y=t.right,x=t.left,C=t.backgroundColor,E=t.tooltipColor,k=t.centerArrow,P=t.setTargetTooltip,S=void 0===P?function(){}:P,z=i({clientTop:0,clientLeft:0,posPlacement:null,arrowPos:null}),O=i(null),L=K(),N=function(){return w?"top":y?"right":g?"bottom":x?"left":c||"top"};return r((function(){var n,t,o,r,i=(O||{}).current;if(S(i),!e||s.isNil(a))return z.current.clientTop=null,void(z.current.clientLeft=0);if(i&&p){var l=N(),c=p.getBoundingClientRect(),u=c.width,f=c.height,d=c.top,m=c.bottom,h=c.left,v=c.right,w=d+window.pageYOffset,g=m+window.pageYOffset,y=h+window.pageXOffset,x=v+window.pageXOffset,C={top:function(){return w-i.clientHeight-8},bottom:function(){return g+8},left:function(){return y-i.clientWidth-10},right:function(){return x+10}},E=function(){return _(Boolean(k),y,i,u,h,v,"horizontal")},P=function(){return _(Boolean(k),w,i,f,d,m,"vertical")},L=0,W=0,M=0,T=function(n){var t;l=n,L=C[n](),t=E(),W=t[0],M=t[1]},j=function(n){var t;l=n,W=C[n](),L=w,t=P(),L=t[0],M=t[1]};switch(l){case"top":if((L=C.top())<0)return T("bottom");n=E(),W=n[0],M=n[1];break;case"bottom":if((L=C.bottom())>U())return T("top");t=E(),W=t[0],M=t[1];break;case"left":if(W=C.left(),L=w,W<0)return j("right");if(W+i.clientWidth>Q())return T("top");if(o=P(),L=o[0],M=o[1],L<0)return T("bottom");break;case"right":if(W=C.right(),L=w,W+i.clientWidth>Q())return j("left");if(W<0)return T("top");if(r=P(),L=r[0],M=r[1],L<0)return T("bottom")}z.current=b(b({},z.current),{arrowPos:M,clientTop:L,clientLeft:W,posPlacement:l})}}),[e,p,d,a,l,c,w,y,g,x]),L&&e?h(n.createElement(G,{id:o,ref:O,className:u.joinClass([l,"ldk-placement-".concat(z.current.posPlacement)]),top:z.current.clientTop,left:z.current.clientLeft,pos:z.current.posPlacement,arrowPos:z.current.arrowPos,limitWidth:f,delayShow:Z(m),display:v,backgroundColor:C,tooltipColor:E},n.createElement("div",{className:"ldk-icon"}),n.createElement(q,{className:"ldk-content"},n.createElement(J,null,a))),L):n.createElement(n.Fragment,null)},tn=function(t){var o=t.children,h=t.tagName,v=t.className,w=t.style,g=t.tooltipClassName,x=t.tooltipContent,C=t.placement,E=void 0===C?"top":C,k=t.trigger,P=void 0===k?"hover":k,S=t.delayShow,z=void 0===S?250:S,O=t.display,L=void 0===O?"fade":O,N=t.backgroundColor,W=t.tooltipColor,M=t.limitWidth,T=void 0===M||M,j=t.handleClick,I=void 0===j?function(){}:j,B=t.handleMouseEnter,H=void 0===B?function(){}:B,A=t.handleMouseLeave,D=void 0===A?function(){}:A,X=t.onClick,Y=void 0===X?function(){}:X,F=t.onMouseEnter,$=void 0===F?function(){}:F,q=t.onMouseLeave,G=void 0===q?function(){}:q,J=t.onShown,K=void 0===J?function(){}:J,Q=t.onHidden,U=void 0===Q?function(){}:Q,Z=t.mouseWheel,_=void 0===Z||Z,tn=t.shareContext,on=void 0===tn||tn,en=t.open,rn=t.showSync,an=t.hideIfResize,ln=void 0===an||an,cn=t.hideIfScroll,sn=t.top,un=t.bottom,pn=t.right,fn=t.left,dn=t.centerArrow,mn=t.forceHide,hn=y(t,["children","tagName","className","style","tooltipClassName","tooltipContent","placement","trigger","delayShow","display","backgroundColor","tooltipColor","limitWidth","handleClick","handleMouseEnter","handleMouseLeave","onClick","onMouseEnter","onMouseLeave","onShown","onHidden","mouseWheel","shareContext","open","showSync","hideIfResize","hideIfScroll","top","bottom","right","left","centerArrow","forceHide"]),vn=e(h)[0],wn=e(s.idv4Time("dk-ttip"))[0],gn=e({}),bn=gn[0],yn=gn[1],xn=e(null),Cn=xn[0],En=xn[1],kn=e(null),Pn=kn[0],Sn=kn[1],zn=i([]),On=p.useWindowSize(),Ln="manual"===P,Nn=["hover","focus"].includes(P);r((function(){var n=bn.target||zn.current[0];en&&n&&(yn({target:n,show:!1}),setTimeout((function(){return yn((function(n){return b(b({},n),{show:!0})}))})))}),[en]),r((function(){Ln&&yn({target:zn.current[0],show:rn})}),[rn]),r((function(){ln&&Wn()}),[ln,On]),r((function(){!s.isNil(mn)&&Wn()}),[mn]),r((function(){return bn.show?(document.addEventListener("mousedown",jn),document.addEventListener("touchstart",jn),document.addEventListener("scroll",Mn),_&&document.addEventListener("wheel",Mn,{passive:!0})):(Tn(),En(null)),function(){Tn()}}),[bn.show]);var Wn=function(){bn.show&&(En(null),Tn(),yn((function(n){return b(b({},n),{show:!1})})),U(!1))},Mn=function(){cn&&Wn()},Tn=function(){document.removeEventListener("mousedown",jn),document.removeEventListener("touchstart",jn),document.removeEventListener("scroll",Mn),_&&document.removeEventListener("wheel",Mn)},jn=function(n){void 0===n&&(n=window.event);try{var t=n.target,o=null==t?void 0:t.closest("#".concat(wn));if(Ln||o)return}catch(n){}var e=bn.target&&u.elContains(bn.target,n.target);V(n)||!bn.target||e||Wn()},In=function(n,t){var e=n.target,r=function(){yn({show:!0,target:zn.current[t]}),K(),n.preventDefault(),n.stopPropagation()};return a.count(o)>1?bn.target===zn.current[t]&&bn.show?(n.preventDefault(),n.stopPropagation(),Wn(),void yn({show:!1,target:zn.current[t]})):void(-1!==t&&r()):u.elContains(bn.target,e)&&bn.show?(n.preventDefault(),void n.stopPropagation()):void(-1!==t&&r())},Bn=function(n){D(n),G(n),Nn&&Wn()},Hn=function(n){return b({onMouseEnter:function(t){return function(n,t){H(n),$(n),Nn&&In(n,t)}(t,n)},onMouseLeave:Bn,onClick:function(t){return function(n,t){I(n),Y(n),"click"===P&&In(n,t)}(t,n)},ref:function(t){return zn.current[n]=t},className:v,style:w},hn)};return n.createElement(R,{shareContext:on,showTooltip:function(n){En(n),yn((function(n){return b(b({},n),{show:!0})})),K()},hideTooltip:Wn,isShow:Boolean(bn.show),tooltipId:wn,tooltipElement:Pn},n.createElement(f,null,n.createElement(d,{condition:Boolean(vn)},n.createElement(vn,b({},Hn(0)),o)),n.createElement(m,null,a.map(o,(function(n,t){return l(n)?c(n,b({},Hn(t))):n})))),n.createElement(nn,{tooltipId:wn,isShow:Boolean(bn.show),tooltipClassName:g,tooltipContent:Cn||x,placement:E,target:bn.target,limitWidth:T,resizeSize:On,delayShow:z,display:L,top:sn,bottom:un,right:pn,left:fn,backgroundColor:N,tooltipColor:W,centerArrow:dn,setTargetTooltip:Sn}))};export{tn as Tooltip,J as TooltipContent,R as TooltipContext,nn as TooltipPortal,tn as default,Z as getLazyTime,V as isMouseRightClick,U as overHeight,Q as overWidth,K as usePortalTooltip,X as useTooltipContext};
